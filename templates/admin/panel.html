{% extends "base.html" %}
{% block title %}Administración{% endblock %}
{% block content %}
<h3 class="mb-4"><i class="bi bi-people-gear me-2"></i>Usuarios & Roles</h3>

<div class="table-responsive shadow-sm bg-white rounded-3">
  <table class="table table-hover align-middle mb-0">
    <thead class="table-light">
      <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>Nombre</th>
        <th>Email</th>
        <th>Activo</th>
        <th>Roles actuales</th>
        <th style="width: 320px;">Asignar rol</th>
      </tr>
    </thead>
    <tbody>
      {% for u in usuarios %}
      <tr>
        <td class="text-muted">{{ u.id_usuario }}</td>
        <td class="fw-semibold">{{ u.usuario_login }}</td>
        <td>{{ u.nombre_completo }}</td>
        <td class="text-muted">{{ u.email }}</td>
        <td>
          {% if u.activo %}<span class="badge text-bg-success">Sí</span>
          {% else %}<span class="badge text-bg-secondary">No</span>{% endif %}
        </td>
        <td>
          {% set rs = roles_por_usuario.get(u.id_usuario, set()) %}
          {% if rs %}
            {% for r in rs %}
              <span class="badge text-bg-light border me-1">{{ r }}</span>
            {% endfor %}
          {% else %}
            <span class="text-muted">Sin rol</span>
          {% endif %}
        </td>
        <td>
          <form class="d-flex gap-2" method="post" action="{{ url_for('admin.set_rol', id_usuario=u.id_usuario) }}">
            <select name="id_rol" class="form-select">
              {% for r in roles %}
                <option value="{{ r.id_rol }}">{{ r.nombre }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-primary">
              <i class="bi bi-check2-circle me-1"></i>Guardar
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
