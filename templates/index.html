{% extends "base.html" %}
{% block title %}Inicio{% endblock %}
{% block content %}

<!-- Hero / Acciones rápidas -->
<div class="p-4 p-md-5 mb-4 bg-white border rounded-3 shadow-sm">
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
    <div>
      <h2 class="fw-bold mb-1">
        Bienvenido{% if current_user.is_authenticated %}, {{ current_user.usuario_login }}{% endif %}
      </h2>
      <p class="text-muted mb-0">Gestiona órdenes, abonos y facturación de manera rápida.</p>
    </div>

    <div class="d-flex flex-wrap gap-2">
      {% if has_role('administrador') or has_role('facturador') %}
        <a class="btn btn-primary" href="{{ url_for('orden.nueva') }}">
          <i class="bi bi-clipboard-plus me-1"></i> Nueva orden
        </a>
        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#facturarModal">
          <i class="bi bi-receipt me-1"></i> Facturar
        </button>
      {% endif %}
    </div>
  </div>
</div>

<!-- Tarjetas del panel -->
<div class="row row-cols-1 row-cols-md-3 g-4">

  {% if has_role('administrador') or has_role('facturador') %}
  <!-- Órdenes -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-clipboard-check fs-1 text-warning mb-3"></i>
        <h5 class="card-title">Órdenes de trabajo</h5>
        <p class="card-text text-muted">Crear orden, registrar abonos e imprimir OT.</p>
        <a href="{{ url_for('orden.nueva') }}" class="btn btn-warning text-white">
          <i class="bi bi-clipboard-plus me-1"></i> Ir
        </a>

        <!-- NUEVO: Imprimir OT rápida -->
        <hr class="my-3">
        <div class="text-start">
          <label class="form-label small text-muted mb-1">Imprimir OT rápida</label>
          <div class="input-group input-group-sm">
            <span class="input-group-text">#</span>
            <input id="ot-print-id" type="number" min="1" class="form-control" placeholder="N° de OT">
            <button class="btn btn-outline-secondary" type="button" onclick="gotoImprimirOT()">
              <i class="bi bi-printer me-1"></i> Imprimir
            </button>
          </div>
        </div>
        <!-- /NUEVO -->
      </div>
    </div>
  </div>

  <!-- Facturación 
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-receipt fs-1 text-primary mb-3"></i>
        <h5 class="card-title">Facturación</h5>
        <p class="card-text text-muted">Emitir factura con IVA 15% e imprimir.</p>
        <a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#facturarModal">
          <i class="bi bi-arrow-right-circle me-1"></i> Facturar
        </a>
      </div>
    </div>
  </div>-->
  {% endif %}

  <!-- Cliente -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-person-circle fs-1 text-primary mb-3"></i>
        <h5 class="card-title">Cliente</h5>
        <p class="card-text text-muted">Gestión de clientes y datos personales.</p>
        <a href="{{ url_for('cliente.form') }}" class="btn btn-primary">Ir</a>
      </div>
    </div>
  </div>

  <!-- Equipo -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-phone fs-1 text-success mb-3"></i>
        <h5 class="card-title">Equipo</h5>
        <p class="card-text text-muted">Registro de equipos asociados a clientes.</p>
        <a href="{{ url_for('equipo.form') }}" class="btn btn-success">Ir</a>
      </div>
    </div>
  </div>

  {% if has_role('administrador') %}
  <!-- Administración -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-people-gear fs-1 text-danger mb-3"></i>
        <h5 class="card-title">Administración</h5>
        <p class="card-text text-muted">Usuarios, roles y asignaciones.</p>
        <a href="{{ url_for('admin.panel') }}" class="btn btn-danger">Abrir</a>
      </div>
    </div>
  </div>

  <!-- Catálogo de servicio -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-list-check fs-1 text-info mb-3"></i>
        <h5 class="card-title">Catálogo de servicio</h5>
        <p class="card-text text-muted">Servicios disponibles para órdenes.</p>
        <a href="{{ url_for('cat_servicio.form') }}" class="btn btn-info text-white">Ir</a>
      </div>
    </div>
  </div>

  <!-- Repuesto -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-cpu fs-1 text-warning mb-3"></i>
        <h5 class="card-title">Repuesto</h5>
        <p class="card-text text-muted">Gestión de repuestos en inventario.</p>
        <a href="{{ url_for('repuesto.form') }}" class="btn btn-warning text-white">Ir</a>
      </div>
    </div>
  </div>

  <!-- Detalle servicio -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-tools fs-1 text-info mb-3"></i>
        <h5 class="card-title">Detalle servicio</h5>
        <p class="card-text text-muted">Servicios aplicados en una orden.</p>
        <a href="{{ url_for('detalle_servicio.form') }}" class="btn btn-info text-white">Ir</a>
      </div>
    </div>
  </div>

  <!-- Detalle repuesto -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-bag-check fs-1 text-danger mb-3"></i>
        <h5 class="card-title">Detalle repuesto</h5>
        <p class="card-text text-muted">Repuestos usados en la reparación.</p>
        <a href="{{ url_for('detalle_repuesto.form') }}" class="btn btn-danger">Ir</a>
      </div>
    </div>
  </div>

  <!-- Caja -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-safe2 fs-1 text-secondary mb-3"></i>
        <h5 class="card-title">Caja</h5>
        <p class="card-text text-muted">Apertura y cierre de caja diaria.</p>
        <a href="{{ url_for('caja.form') }}" class="btn btn-secondary">Ir</a>
      </div>
    </div>
  </div>

  <!-- Movimiento de caja -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-arrow-left-right fs-1 text-dark mb-3"></i>
        <h5 class="card-title">Movimiento de caja</h5>
        <p class="card-text text-muted">Registra ingresos y egresos de caja.</p>
        <a href="{{ url_for('mov_caja.form') }}" class="btn btn-dark">Ir</a>
      </div>
    </div>
  </div>

  <!-- Comprobante -->
  <div class="col">
    <div class="card h-100 shadow-sm border-0 text-center">
      <div class="card-body">
        <i class="bi bi-journal-text fs-1 text-primary mb-3"></i>
        <h5 class="card-title">Comprobantes</h5>
        <p class="card-text text-muted">Consulta e impresión de comprobantes.</p>
        <a href="{{ url_for('comprobante.form') }}" class="btn btn-primary">Ir</a>
      </div>
    </div>
  </div>
  {% endif %}

</div>

<!-- Nota de ayuda -->
<div class="mt-4 text-muted small">
  <i class="bi bi-info-circle me-1"></i>
  Las <strong>Órdenes</strong> incluyen el registro de <strong>abonos</strong> dentro del mismo flujo.
</div>

<!-- JS local para imprimir OT rápida -->
<script>
  function gotoImprimirOT() {
    const v = (document.getElementById('ot-print-id').value || '').trim();
    if (!v) return;
    window.location.href = `/orden/imprimir/${encodeURIComponent(v)}`;
  }
</script>
{% endblock %}

